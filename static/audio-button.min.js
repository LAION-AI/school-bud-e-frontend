var y=Object.defineProperty;var f=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var g=(s,o,t)=>o in s?y(s,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[o]=t,p=(s,o)=>{for(var t in o||(o={}))x.call(o,t)&&g(s,t,o[t]);if(f)for(var t of f(o))b.call(o,t)&&g(s,t,o[t]);return s};var r=(s,o,t)=>(g(s,typeof o!="symbol"?o+"":o,t),t);var d=(s,o,t)=>new Promise((e,i)=>{var a=n=>{try{h(t.next(n))}catch(u){i(u)}},l=n=>{try{h(t.throw(n))}catch(u){i(u)}},h=n=>n.done?e(n.value):Promise.resolve(n.value).then(a,l);h((t=t.apply(s,o)).next())});var w;class m extends HTMLElement{constructor(t={}){super();r(this,"shadow");r(this,"config");r(this,"isRecording",!1);r(this,"mediaRecorder",null);r(this,"audioChunks",[]);this.config=this.parseConfig(t),this.shadow=this.attachShadow({mode:"open"}),this.initialize()}parseConfig(t){const e=new URLSearchParams(window.location.search),i={id:e.get("id")||void 0,color:e.get("color")||void 0,position:e.get("position")||"bottom-right",size:e.get("size")||"medium",sttUrl:e.get("sttUrl")||"",sttKey:e.get("sttKey")||"",sttModel:e.get("sttModel")||""};return p(p({},i),t)}initialize(){const t=document.createElement("style");t.textContent=`
      :host {
        position: fixed;
        ${this.getPositionStyles()}
        z-index: 9999;
      }

      .audio-button {
        border: none;
        border-radius: 50%;
        cursor: pointer;
        background-color: ${this.config.color||"#4A90E2"};
        padding: ${this.getSizeStyles()};
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .audio-button:hover {
        transform: scale(1.1);
      }

      .audio-button.recording {
        animation: pulse 1.5s infinite;
        background-color: #FF4444;
      }

      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }

      .mic-icon {
        width: ${this.getIconSize()};
        height: ${this.getIconSize()};
        fill: white;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 10000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background-color: white;
        padding: 2rem;
        border-radius: 1rem;
        width: 90%;
        max-width: 400px;
        text-align: center;
      }

      .avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin: 0 auto 1rem;
      }

      .recording-animation {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: #FF4444;
        margin: 1rem auto;
        animation: pulse 1.5s infinite;
      }
    `;const e=document.createElement("button");e.className="audio-button",e.innerHTML=this.getMicrophoneIcon(),e.addEventListener("click",()=>this.toggleRecording());const i=this.createModal();this.shadow.appendChild(t),this.shadow.appendChild(e),this.shadow.appendChild(i)}getPositionStyles(){switch(this.config.position){case"bottom-right":return"bottom: 20px; right: 20px;";case"bottom-left":return"bottom: 20px; left: 20px;";case"top-right":return"top: 20px; right: 20px;";case"top-left":return"top: 20px; left: 20px;";default:return"bottom: 20px; right: 20px;"}}getSizeStyles(){switch(this.config.size){case"small":return"12px";case"large":return"20px";default:return"16px"}}getIconSize(){switch(this.config.size){case"small":return"16px";case"large":return"32px";default:return"24px"}}getMicrophoneIcon(){return`
      <svg class="mic-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
      </svg>
    `}createModal(){const t=document.createElement("div");t.className="modal";const e=document.createElement("div");e.className="modal-content";const i=document.createElement("img");i.className="avatar",i.src="/logo.png",i.alt="School Bud-E Avatar";const a=document.createElement("div");return a.className="recording-animation",a.style.display="none",e.appendChild(i),e.appendChild(a),t.appendChild(e),t.addEventListener("click",l=>{l.target===t&&this.closeModal()}),t}showModal(){const t=this.shadow.querySelector(".modal");t&&t.classList.add("active")}closeModal(){const t=this.shadow.querySelector(".modal");t&&(t.classList.remove("active"),this.isRecording&&this.stopRecording())}toggleRecording(){return d(this,null,function*(){this.isRecording?this.stopRecording():(this.showModal(),yield this.startRecording())})}startRecording(){return d(this,null,function*(){try{const t=yield navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(t),this.audioChunks=[],this.mediaRecorder.ondataavailable=e=>{this.audioChunks.push(e.data)},this.mediaRecorder.onstop=()=>d(this,null,function*(){const e=new Blob(this.audioChunks,{type:"audio/wav"});yield this.sendAudioToServer(e)}),this.mediaRecorder.start(),this.isRecording=!0,this.updateButtonState()}catch(t){console.error("Error starting recording:",t)}})}stopRecording(){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.mediaRecorder.stop(),this.isRecording=!1,this.updateButtonState())}sendAudioToServer(t){return d(this,null,function*(){const e=new FormData;e.append("audio",t,"recording.wav"),e.append("sttUrl",this.config.sttUrl||""),e.append("sttKey",this.config.sttKey||""),e.append("sttModel",this.config.sttModel||"");try{const i=yield fetch("/api/stt",{method:"POST",body:e});if(i.ok){const a=yield i.text();this.dispatchEvent(new CustomEvent("transcription",{detail:a}))}else console.error("Failed to upload audio")}catch(i){console.error("Error uploading audio:",i)}})}updateButtonState(){const t=this.shadow.querySelector(".audio-button"),e=this.shadow.querySelector(".recording-animation");t&&(this.isRecording?(t.classList.add("recording"),e&&(e.style.display="block")):(t.classList.remove("recording"),e&&(e.style.display="none"),this.closeModal()))}}customElements.define("audio-button",m);const c=new m;if((w=c.config)!=null&&w.id){const s=document.getElementById(c.config.id);s&&s.replaceWith(c)}else document.body.appendChild(c);export{m as AudioButton};
